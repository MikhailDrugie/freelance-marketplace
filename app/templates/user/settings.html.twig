{% extends 'base.html.twig' %}

{% block title %}Настройки{% endblock %}
{# todo: move js to assets, mb it fixes jquery (import $ from 'jquery') #}
{% block body %}
    <h1>Настройки аккаунта</h1>

    <div class="col-lg-8">
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label><b>Login:</b>
                        <input readonly name="login" value="{{ user.login }}" class="form-control">
                    </label>
                </div>
                <div class="form-group">
                    <label><b>Email:</b>
                        <input readonly name="email" value="{{ user.email }}" class="form-control">
                    </label>
                </div>
                <div class="form-group">
                    <label><b>Имя:</b>
                        <input readonly name="fullName" value="{{ user.fullName }}" class="form-control">
                    </label>
                </div>
                <br>
                <button class="btn btn-danger account-delete" data-user-id="{{ user.id }}">Удалить аккаунт</button>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <b>Пароль:</b>
                    <button class="btn btn-danger password-change">Изменить</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block custom_js %}
    <script>
        $('.account-delete').on('click', function (e) {
            e.preventDefault();
            let userId = $(this).data('user-id');
            if (!confirm('Вы уверены, что хотите удалить аккаунт?')) return;
            $.ajax({
                url: "{{ path('delete-user') }}",
                method: 'POST',
                dataType: 'json',
                data: {'userId': userId, '_csrf_token': "{{ csrf_token('authenticate') }}"},
                success: function () {
                    alert('Аккаунт успешно удален');
                    window.location.href = "{{ path('index') }}";
                },
                error: function(response) {
                    alert('Ошибка удаления аккаунта');
                    window.reload();
                }
            });
        });

        $('.password-change').on('click', function (e) {
            e.preventDefault();
            window.location.href = "{{ path('password-change') }}";
        });
    </script>
{% endblock %}